<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ProfileFileManager Test Case Comparison</title>
    <style>
    body {
      font-family: 'Times New Roman', serif;
      background-color: #EEEEEE;
      margin-left: 2em;
    }
    p,ul {
      max-width: 45em;
      margin-left: 4em;
    }
    span.callout {
      font-family: 'Lucida Console', 'Courier New', monospace;
      font-size: 80%;
      max-width: 45em;
      margin-left: 4em;
    }
    th {
      font-family: 'Times New Roman', serif;
      font-size: 200%;
    }
    tr.code {
        margin-bottom: 2em;
        font-size: 80%; 
        font-family: 'Lucida Console', 'Courier New', monospace;
    }
    td.code {
        margin-left: 2em;
    }
    pre.code {
        margin-left: 8em;
    }
    </style>
</head>
<body>

<table style="border-collapse: collapse;">
<thead>
<tr> 
<th colspan="2">Digression: ProfileFileManager JUnit Test Development</th>
</tr>
</thead>
<tbody>
<tr>
<td colspan="2">
<p>
This page isn't about JUnit test development specifically.
It's more about developing facilities
to support JUnit test methods
for the <em>ProfileFileManagerTest</em> class.
The discussion below assumes
that you have read the first part of the
<a href="https://judahstutorials.com/cartesian-plane-lesson-18-page-x4c-profilefilemanager-junittest/">
    Cartesian Plane Lesson 18 Page X4C: ProfileFileManager JUnitTest
</a>
page.
Any code you find here should be considered pseudocode.
Do not expect to find anything on this page
checked into the GitHub respository.
</p>
<p>
To best understand the pseudocode,
you should be familiar with the methods
discussed on the above referenced page
prior to the link to this page.
In addition to those,
we will be referencing the following two methods.
See the discussion below for additional details.
</p>
</td>
</tr>

<tr> 
<td style="border: .2em solid black;">private Thread executeChooserOp( Runnable runner )</td>
<td style="border: .2em solid black;">private Thread executeNonChooserOp( Runnable runner )</td>
</tr>
<tr> 
<td style="border: .2em solid black; vertical-align: top; 0;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7
8
9</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">private</span> Thread <span style="color: #0066BB; font-weight: bold">executeChooserOp</span><span style="color: #333333">(</span> Runnable runner <span style="color: #333333">)</span>
<span style="color: #333333">{</span>
    Thread  thread  <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Thread<span style="color: #333333">(</span> runner <span style="color: #333333">);</span>
    thread<span style="color: #333333">.</span><span style="color: #0000CC">start</span><span style="color: #333333">();</span>
    Utils<span style="color: #333333">.</span><span style="color: #0000CC">pause</span><span style="color: #333333">(</span> <span style="color: #0000DD; font-weight: bold">250</span> <span style="color: #333333">);</span>
    getFileChooserComponents<span style="color: #333333">();</span>
    assertTrue<span style="color: #333333">(</span> fileChooser<span style="color: #333333">.</span><span style="color: #0000CC">isVisible</span><span style="color: #333333">()</span> <span style="color: #333333">);</span>
    <span style="color: #008800; font-weight: bold">return</span> thread<span style="color: #333333">;</span>
<span style="color: #333333">}</span>
</pre></td></tr></tbody></table></div>

</td>
<td style="border: .2em solid black; vertical-align: top; 0;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7
8
9</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">private</span> Thread <span style="color: #0066BB; font-weight: bold">executeNonChooserOp</span><span style="color: #333333">(</span> Runnable runner <span style="color: #333333">)</span>
<span style="color: #333333">{</span>
    Thread  thread  <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Thread<span style="color: #333333">(</span> runner <span style="color: #333333">);</span>
    thread<span style="color: #333333">.</span><span style="color: #0000CC">start</span><span style="color: #333333">();</span>

    
    
    <span style="color: #008800; font-weight: bold">return</span> thread<span style="color: #333333">;</span>
<span style="color: #333333">}</span>
</pre></td></tr></tbody></table></div>

</td>
</tr>

<tr>
<td colspan="2">
<ul>
<li>
Line 1:
These two methods are called
when we want to execute a file manager operation.
Use <em>executeChooserOp</em> if the operation
requires the file chooser to be posted,
otherwise, use <em>executeNonChooserOp</em>.
The parameter is a <em>Runnable</em>
the executes the operation, for example:<br>
<span class = "callout">
() -> adHocResult = fileMgr.save( profile, adHocFile )
</span>
</li>
<li>
Lines 3,4:
Start the given operation
in a dedicated thread.
We've seen this strategy before;
the thread will be returned to the client
which can then join it,
pausing main thread execution
until the dedicated thread completes.
</li>
<li>
Lines 5-7:
If necessary,
give the file chooser time to post,
then collect the file chooser components
(the text field and the save button)
and verify that the chooser is visible.
</li>
<li>
Line 8:
Return a reference to the dedicated thread
to the client.
</li>
</ul>

<p>
Here are two test methods 
that save a <em>Profile</em> to a file.
The one on the right
saves a given <em>Profile</em>
to a file of the operator's choice;
The one on the left
requires no operator interaction.
Let's first discuss
the logic behind the tests.
</p>
</td>
</tr>

<tr> 
<td style="border: .2em solid black;">save( Profile profile, File file )</td>
<td style="border: .2em solid black;">saveAs( Profile profile )</td>
</tr>

<tr>
<td style="border: .2em solid black; vertical-align: top; 0;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;" id="testSaveProfile"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #555555; font-weight: bold">@Test</span>
<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">testSaveProfileFileGoRight</span><span style="color: #333333">()</span>
<span style="color: #333333">{</span>
    adHocFile<span style="color: #333333">.</span><span style="color: #0000CC">delete</span><span style="color: #333333">();</span>
    <span style="color: #888888">// sanity check</span>
    assertFalse<span style="color: #333333">(</span> adHocFile<span style="color: #333333">.</span><span style="color: #0000CC">exists</span><span style="color: #333333">()</span> <span style="color: #333333">);</span>

    <span style="color: #333399; font-weight: bold">int</span>     expAction   <span style="color: #333333">=</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">getLastAction</span><span style="color: #333333">();</span>
    Profile profile     <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Profile<span style="color: #333333">();</span>
    profile<span style="color: #333333">.</span><span style="color: #0000CC">setName</span><span style="color: #333333">(</span> <span style="background-color: #fff0f0">&quot;testSaveProfileFileGoRight&quot;</span> <span style="color: #333333">);</span>
    
    Thread  thread  <span style="color: #333333">=</span> executeNonChooserOp<span style="color: #333333">(</span> 
        <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> adHocResult <span style="color: #333333">=</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">save</span><span style="color: #333333">(</span> profile<span style="color: #333333">,</span> adHocFile <span style="color: #333333">)</span>
    <span style="color: #333333">);</span>


    assertFalse<span style="color: #333333">(</span> dismissErrorDialog<span style="color: #333333">()</span> <span style="color: #333333">);</span>
    Utils<span style="color: #333333">.</span><span style="color: #0000CC">join</span><span style="color: #333333">(</span> thread <span style="color: #333333">);</span>
    assertTrue<span style="color: #333333">(</span> adHocResult <span style="color: #333333">);</span>
    assertTrue<span style="color: #333333">(</span> adHocFile<span style="color: #333333">.</span><span style="color: #0000CC">exists</span><span style="color: #333333">()</span> <span style="color: #333333">);</span>
    File    currFile    <span style="color: #333333">=</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">getCurrFile</span><span style="color: #333333">();</span>
    <span style="color: #333399; font-weight: bold">int</span>     lastAction  <span style="color: #333333">=</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">getLastAction</span><span style="color: #333333">();</span>
    assertTrue<span style="color: #333333">(</span> compareFiles<span style="color: #333333">(</span> adHocFile<span style="color: #333333">,</span> currFile <span style="color: #333333">)</span> <span style="color: #333333">);</span>
    assertTrue<span style="color: #333333">(</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">getLastResult</span><span style="color: #333333">()</span> <span style="color: #333333">);</span>
    assertEquals<span style="color: #333333">(</span> expAction<span style="color: #333333">,</span> lastAction <span style="color: #333333">);</span>

    thread  <span style="color: #333333">=</span> executeNonChooserOp<span style="color: #333333">(</span> 
        <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> adHocProfile <span style="color: #333333">=</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">open</span><span style="color: #333333">(</span> adHocFile <span style="color: #333333">)</span>
    <span style="color: #333333">);</span>
    assertFalse<span style="color: #333333">(</span> dismissErrorDialog<span style="color: #333333">()</span> <span style="color: #333333">);</span>
    Utils<span style="color: #333333">.</span><span style="color: #0000CC">join</span><span style="color: #333333">(</span> thread <span style="color: #333333">);</span>
    assertEquals<span style="color: #333333">(</span> profile<span style="color: #333333">,</span> adHocProfile <span style="color: #333333">);</span>
    assertTrue<span style="color: #333333">(</span> compareFiles<span style="color: #333333">(</span> adHocFile<span style="color: #333333">,</span> currFile <span style="color: #333333">)</span> <span style="color: #333333">);</span>
    assertTrue<span style="color: #333333">(</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">getLastResult</span><span style="color: #333333">()</span> <span style="color: #333333">);</span>
    assertEquals<span style="color: #333333">(</span> expAction<span style="color: #333333">,</span> lastAction <span style="color: #333333">);</span>
<span style="color: #333333">}</span>
</pre></td></tr></tbody></table></div>

</td>
<td style="border: .2em solid black; vertical-align: top;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #555555; font-weight: bold">@Test</span>
<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">testSaveAsProfileGoRight</span><span style="color: #333333">()</span>
<span style="color: #333333">{</span>
    adHocFile<span style="color: #333333">.</span><span style="color: #0000CC">delete</span><span style="color: #333333">();</span>
    <span style="color: #888888">// sanity check</span>
    assertFalse<span style="color: #333333">(</span> adHocFile<span style="color: #333333">.</span><span style="color: #0000CC">exists</span><span style="color: #333333">()</span> <span style="color: #333333">);</span>


    Profile profile     <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Profile<span style="color: #333333">();</span>
    profile<span style="color: #333333">.</span><span style="color: #0000CC">setName</span><span style="color: #333333">(</span> <span style="background-color: #fff0f0">&quot;testSaveAsProfileGoRight&quot;</span> <span style="color: #333333">);</span>
    
    Thread  thread  <span style="color: #333333">=</span> executeChooserOp<span style="color: #333333">(</span> 
        <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> adHocResult <span style="color: #333333">=</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">saveAs</span><span style="color: #333333">(</span> profile <span style="color: #333333">)</span>
    <span style="color: #333333">);</span>
    enterPath<span style="color: #333333">(</span> adHocName <span style="color: #333333">);</span>
    clickOn<span style="color: #333333">(</span> saveButton <span style="color: #333333">);</span>
    assertFalse<span style="color: #333333">(</span> dismissErrorDialog<span style="color: #333333">()</span> <span style="color: #333333">);</span>
    Utils<span style="color: #333333">.</span><span style="color: #0000CC">join</span><span style="color: #333333">(</span> thread <span style="color: #333333">);</span>
    assertTrue<span style="color: #333333">(</span> adHocResult <span style="color: #333333">);</span>
    assertTrue<span style="color: #333333">(</span> adHocFile<span style="color: #333333">.</span><span style="color: #0000CC">exists</span><span style="color: #333333">()</span> <span style="color: #333333">);</span>
    File    currFile    <span style="color: #333333">=</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">getCurrFile</span><span style="color: #333333">();</span>
    <span style="color: #333399; font-weight: bold">int</span>     lastAction  <span style="color: #333333">=</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">getLastAction</span><span style="color: #333333">();</span>
    assertTrue<span style="color: #333333">(</span> compareFiles<span style="color: #333333">(</span> adHocFile<span style="color: #333333">,</span> currFile <span style="color: #333333">)</span> <span style="color: #333333">);</span>
    assertTrue<span style="color: #333333">(</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">getLastResult</span><span style="color: #333333">()</span> <span style="color: #333333">);</span>
    assertEquals<span style="color: #333333">(</span> ProfileFileManager<span style="color: #333333">.</span><span style="color: #0000CC">APPROVE</span><span style="color: #333333">,</span> lastAction <span style="color: #333333">);</span>

    thread  <span style="color: #333333">=</span> executeNonChooserOp<span style="color: #333333">(</span> 
        <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> adHocProfile <span style="color: #333333">=</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">open</span><span style="color: #333333">(</span> adHocFile <span style="color: #333333">)</span>
    <span style="color: #333333">);</span>
    assertFalse<span style="color: #333333">(</span> dismissErrorDialog<span style="color: #333333">()</span> <span style="color: #333333">);</span>
    Utils<span style="color: #333333">.</span><span style="color: #0000CC">join</span><span style="color: #333333">(</span> thread <span style="color: #333333">);</span>
    assertEquals<span style="color: #333333">(</span> profile<span style="color: #333333">,</span> adHocProfile <span style="color: #333333">);</span>
    assertTrue<span style="color: #333333">(</span> compareFiles<span style="color: #333333">(</span> adHocFile<span style="color: #333333">,</span> currFile <span style="color: #333333">)</span> <span style="color: #333333">);</span>
    assertTrue<span style="color: #333333">(</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">getLastResult</span><span style="color: #333333">()</span> <span style="color: #333333">);</span>
    assertEquals<span style="color: #333333">(</span> ProfileFileManager<span style="color: #333333">.</span><span style="color: #0000CC">APPROVE</span><span style="color: #333333">,</span> lastAction <span style="color: #333333">);</span>
<span style="color: #333333">}</span>
</pre></td></tr></tbody></table></div>

</td>
</tr>
<tr>
<td colspan="2">
<ul>
    <li>
    Lines 4-6:
    At the conclusion of the test,
    we expect to find a file
    containing <em>Profile</em> properties.
    At the beginning of the test
    make sure the file doesn't exist;
    at the end, one of our validations
    will be to assert that the file exists.
    </li>
    <li>
    Line 8:
    The method that saves
    to an explicit file
    requires no interaction with the file chooser,
    so after the operation completes
    we will expect the <em>lastAction</em> property
    to be unchanged.
    On this line we save the current value of <em>lastAction</em>
    so that at the end of the test
    we can verify that it hasn't changed.
    </li>
    <li>
    Lines 9,10:
    Instantiate the Profile we want to save;
    give it at least one unique property
    so that,
    after the conclusion of the operation,
    we can verify that
    the given Profile 
    is correctly saved to the given file.
    <p id="Caveat1">
    Caveat: 
    At the conclusion of the <em>saveAs</em> operation
    we expect the <em>lastAction</em> property
    to be <em>SAVE</em>.
    But, if it is,
    we have no way of knowing
    whether the operation set it to <em>SAVE</em>,
    or it was <em>SAVE</em>
    at the start of the operation.
    We will address this issue below.
    </p>
    </li>
    <li>
    Lines 12-14:
    Initiate the given operation 
    in a dedicated thread.
    </li>
    <li>
    Lines 15,16:
    The operation that requires operator interaction via the file chooser
    has to enter a file name into the chooser's text field
    and push its <em>Save</em> button.
    </li>
    <li>
    Line 17:
    Both operations potentially raise I/O errors.
    We're not expecting one,
    so check for an error dialog and assert that there isn't one.
    </li>
    <li>
    Line 18:
    Wait for the operation to complete.
    </li>
    <li>
    Line 19:
    Validate the operation's return value.
    </li>
    <li>
    Line 20:
    Verify that the file has been created.
    </li>
    <li>
    Lines 21-25:
    Validate the <em>ProfileFileManager's</em>
    <em>lastAction</em> and <em>currfile</em> properties.
    For the operation that uses the file chooser
    the expected value of <em>lastAction</em> is <em>APPROVE;</em>
    for the operation requiring no operator interaction,
    the expected value is whatever it was
    at the start of the operation
    </li>
    <li>
    Lines 27-35:
    Read the saved file
    and verify its contents.
        <ul style="margin-left: 0;">
            <li>
                Lines 27-29: Read the saved file.
            </li>
            <li>
                Line 30: Verify that no error dialog was posted.
            </li>
            <li>
                Line 31: Wait for the operation to complete.
            </li>
            <li>
                Lines 32: Verify the contents of the <em>Profile</em>.
            </li>
            <li>
                Lines 33-35: 
                Verify the file manager's <em>currFile, lastResult,</em>
                and <em>lastAction</em> properties.
            </li>
        </ul>
    </li>
</ul>
<p>
A quick look at the above comparison
convinces me that a lot of duplicate code
can be encapsulated in helper methods.
The first thing that captures my attention
is the last three lines
of both methods,
and lines 23-25 of <em>testSaveProfileFileGoRight</em>.
This logic should be executed
not just at the end of every test,
but the end of every operation.
Let's write the following method
to perform those validations:<br>
</p>
<pre class="code">
private void 
validateState( File expFile, boolean expResult, int expAction )
{
    File    currFile    = fileMgr.getCurrFile();
    assertTrue( compareFiles( expFile, currFile ) );
    assertEquals( expResult, fileMgr.getLastResult() );
    assertEquals( expAction, fileMgr.getLastAction() );
}</pre>
<p>
My second observation is that
almost every output test
will conclude with
verifying the output,
as with lines 27-35 above.
This validation can be encapsulated
in a method that reads a given file
and compares it to a given <em>Profile</em>,
such as the following:
</p>
<pre class="code">
private void 
validateFile( Profile expProfile, File file )
{
    verify the given file exists
    int expAction = fileMgr.getLastAction();
    Profile profile = new Profile();
    read the given file without going through the file chooser:
        () -> fileMgr.open( file, profile );
    assertEquals( expProfile, profile );
    validateState( file, true, expAction );
}</pre>
<p>
Next, consider that our test cases
are nearly identical
except for interaction with the file chooser.
We can write a method
that performs a save operation
with a simple conditional
that account for
the requirement to use the file chooser.
Consider this strategy:
</p>

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #888888">/*</span>
<span style="color: #888888">    private void saveGoRight( </span>
<span style="color: #888888">        BooleanSupplier supplier, </span>
<span style="color: #888888">        File file, </span>
<span style="color: #888888">        boolean expectChooser</span>
<span style="color: #888888">    )</span>
<span style="color: #888888">{</span>
<span style="color: #888888">    delete the target file</span>
<span style="color: #888888">    expAction = fileMgr.getLastAction()</span>
<span style="color: #888888">    formulate the Runnable that will drive a dedicated thread:</span>
<span style="color: #888888">        Runnable    runner      = </span>
<span style="color: #888888">            () -&gt; adHocResult = supplier.getAsBoolean();</span>
<span style="color: #888888">    create and start the thread</span>
<span style="color: #888888">    pause to allow file chooser to post (if necessary)</span>
<span style="color: #888888">    if ( expectChooser )</span>
<span style="color: #888888">    {</span>
<span style="color: #888888">        find the file chooser&#39;s text field</span>
<span style="color: #888888">        enter the file name into the text field</span>
<span style="color: #888888">        click on the save button</span>
<span style="color: #888888">        expAction = APPROVE</span>
<span style="color: #888888">    }</span>
<span style="color: #888888">    verify an error dialog was not posted</span>
<span style="color: #888888">    join the thread</span>
<span style="color: #888888">    verify the value of adHocResult</span>
<span style="color: #888888">    verify the target file exists</span>
<span style="color: #888888">    validateState( file, true, expAction );</span>
<span style="color: #888888">}</span>
<span style="color: #888888">*/</span>
</pre></td></tr></tbody></table></div>

<ul>
<li>
    Line 3: The <em>supplier</em> parameter
    encapsulates the output operation
    to be executed, for example
<em>() -> fileMgr.save(profile, adHocFile)</em> or 
<em>() -> fileMgr.saveAs(profile)</em>.
</li>
<li>
    Line 4: The <em>file</em> parameter
    refers to the file to be operated on,
    <em>ahdHocFile</em> in the 
    <a href="#testSaveProfile">original code</a>.
</li>
<li>
    Parameter <em>expectChooser</em> will be true
    if the operation under test
    requires operator interaction
    with the file chooser.
</li>
<li>
    Line 8: Corresponds to lines 4-6 in the 
    <a href="#testSaveProfile">original code</a>.
</li>
<li>
    Line 9: Sets the "expected action"
    to the current value of 
    the file manager's <em>lastAction</em> property.
    If this operation requires
    operator interaction with the file chooser,
    it will be updated at line 20.
</li>
<li>
    Lines 10-14: Correspond to lines 12-14 in the 
    <a href="#testSaveProfile">original code</a>.
</li>
<li>
    Lines 15-21: This code replaces lines 15 and 16 in the
    <a href="#testSaveProfile">original code</a>.
</li>
<li>
    Lines 22-26: Correspond to lines 30-35 in the 
    <a href="#testSaveProfile">original code</a>.
</li>
</ul>

<p>
My last thought regarding code encapsulation 
is that we have a lot of complications
surrounding the file manager state
(see Caveat, above), such as:
</p>
<div style="margin-left: 2em;">
<p style="margin-bottom: 0;">
    Example 1:
</p>
<ul style="margin-top: 0;">
<li>
    Start with the last-action property = APPROVE;
</li>
<li>
    Begin execution of an operation
    that requires operator interaction
    with the file chooser;
</li>
<li>
    Cancel the operation via the file chooser;
</li>
<li>
    Verify that last-action is now CANCEL.
</li>
</ul>
<p style="margin-bottom: 0;">
    Example 2:
</p>
<ul style="margin-top: 0;">
<li>
    Start with the last-result property = false;
</li>
<li>
    Begin execution of an operation
    that requires operator interaction
    with the file chooser;
</li>
<li>
    Cancel the operation via the file chooser;
</li>
<li>
    Verify that last-result is still false.
</li>
</ul>
</div>
<p>
To help with state issues,
let's ensure that,
at the conclusion of our <em>BeforeEach</em> method,
our test environment state will be very specific state.
Let's also have methods that we can use
to set the state of the last-action and last-result properties.
The last two methods are necessary
because setting the last-action and last-result states
is non-trivial;
they require executing operations
that will achieve the desired result:
</p>
<p>
&#x1F7E6;<em>public void beforeEach()</em><br>
This method has the following postconditions:
</p>
<ul>
<li>
The <em>PropertyManager</em> state
will be in its original state;
</li>
<li>
Set all the fields associated with file chooser components
(<em>chooserName, openButton,</em> etc.)
will be null;
</li>
<li>
The physical <em>adHocFile</em> will not exist;
all other files will be unchanged
from there initial states.
</li>
<li>
The last-result property will be false;
</li>
<li>
The last-action property will be CANCEL;
</li>
</ul>
<p>
&#x1F7E6;<em>private void setLastAction( int action )</em><br>
This method initiates an input operation
that requires operator interaction with the file chooser.
It dismisses the file chooser dialog
with the given action (<em>APPROVE</em> or <em>CANCEL</em>).
</p>
<p>
&#x1F7E6;<em>private void setLastResult( boolean expResult )</em><br>
This method will initiate an input operation
that does not require interaction with the file chooser.
Depending on the value of <em>expResult</em>,
the input operation will be one
that completes with an I/O error
or one that completes with no error.
</p>
<p>
With the implementation of the above facilities,
our tests for <em>save(Profile, File)</em>
and <em>saveAs(Profile)</em>
look like this:
</p>
</td>
</tr>

<tr> 
<td style="border: .2em solid black;">save( Profile profile, File file )</td>
<td style="border: .2em solid black;">saveAs( Profile profile )</td>
</tr>

<tr>
<td style="border: .2em solid black; vertical-align: top; 0;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #555555; font-weight: bold">@Test</span>
<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">testSaveProfileFileGoRight</span><span style="color: #333333">()</span>
<span style="color: #333333">{</span>
    Profile          profile     <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Profile<span style="color: #333333">();</span>
    profile<span style="color: #333333">.</span><span style="color: #0000CC">setName</span><span style="color: #333333">(</span> <span style="background-color: #fff0f0">&quot;testSaveProfileFileGoRight&quot;</span> <span style="color: #333333">);</span>
    BooleanSupplier  supplier    <span style="color: #333333">=</span> 
        <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">save</span><span style="color: #333333">(</span> profile<span style="color: #333333">,</span> adHocFile <span style="color: #333333">);</span>
    saveGoRight<span style="color: #333333">(</span> supplier<span style="color: #333333">,</span> adHocFile<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">false</span> <span style="color: #333333">);</span>
    validateFile<span style="color: #333333">(</span> profile<span style="color: #333333">,</span> adHocFile <span style="color: #333333">);</span>
<span style="color: #333333">}</span>
</pre></td></tr></tbody></table></div>

</td>
<td style="border: .2em solid black; vertical-align: top;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #555555; font-weight: bold">@Test</span>
<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">testSaveAsProfileGoRight</span><span style="color: #333333">()</span>
<span style="color: #333333">{</span>
    Profile         profile     <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Profile<span style="color: #333333">();</span>
    profile<span style="color: #333333">.</span><span style="color: #0000CC">setName</span><span style="color: #333333">(</span> <span style="background-color: #fff0f0">&quot;testSaveAsProfile&quot;</span> <span style="color: #333333">);</span>
    BooleanSupplier supplier    <span style="color: #333333">=</span> 
        <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">saveAs</span><span style="color: #333333">(</span> profile <span style="color: #333333">);</span>
    saveGoRight<span style="color: #333333">(</span> supplier<span style="color: #333333">,</span> adHocFile<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">true</span> <span style="color: #333333">);</span>
    validateFile<span style="color: #333333">(</span> profile<span style="color: #333333">,</span> adHocFile <span style="color: #333333">);</span>
<span style="color: #333333">}</span>
</pre></td></tr></tbody></table></div>

</td>
</tr>

<tr>
<td colspan="2">
<p>
Next,
let's look at possible implementations for input operations.
In the following figure,
the code on the left
is a possible test method for
<em>ProfileFileManager.open()</em>,
and the one on the left for
<em>ProfileFileManager.open(File)</em>.
The first requires operator interaction
with the file chooser,
the second does not.
</p>
</td>
</tr>

<tr> 
<td style="border: .2em solid black;">open()</td>
<td style="border: .2em solid black;">open( File file )</td>
</tr>

<tr>
<td style="border: .2em solid black; vertical-align: top; 0;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #555555; font-weight: bold">@Test</span>
<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">testOpenGoRight</span><span style="color: #333333">()</span>
<span style="color: #333333">{</span>
    <span style="color: #333399; font-weight: bold">int</span> expAction   <span style="color: #333333">=</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">getLastAction</span><span style="color: #333333">();</span>
    Thread  thread  <span style="color: #333333">=</span> executeChooserOp<span style="color: #333333">(</span> 
        <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> adHocProfile <span style="color: #333333">=</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">open</span><span style="color: #333333">()</span>
    <span style="color: #333333">);</span>
    enterPath<span style="color: #333333">(</span> distinctName <span style="color: #333333">);</span>
    clickOn<span style="color: #333333">(</span> openButton <span style="color: #333333">);</span>
    assertFalse<span style="color: #333333">(</span> dismissErrorDialog<span style="color: #333333">()</span> <span style="color: #333333">);</span>
    Utils<span style="color: #333333">.</span><span style="color: #0000CC">join</span><span style="color: #333333">(</span> thread <span style="color: #333333">);</span>
    assertEquals<span style="color: #333333">(</span> distinctProfile<span style="color: #333333">,</span> adHocProfile <span style="color: #333333">);</span>
    validateState<span style="color: #333333">(</span> distinctFile<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">,</span> expAction <span style="color: #333333">);</span>
<span style="color: #333333">}</span>
</pre></td></tr></tbody></table></div>

</td>
<td style="border: .2em solid black; vertical-align: top;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #555555; font-weight: bold">@Test</span>
<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">testOpenFileGoRight</span><span style="color: #333333">()</span>
<span style="color: #333333">{</span>
    
    Thread  thread  <span style="color: #333333">=</span> executeNonChooserOp<span style="color: #333333">(</span> 
        <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> adHocProfile <span style="color: #333333">=</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">open</span><span style="color: #333333">(</span> distinctFile <span style="color: #333333">)</span>
    <span style="color: #333333">);</span>

    
    assertFalse<span style="color: #333333">(</span> dismissErrorDialog<span style="color: #333333">()</span> <span style="color: #333333">);</span>
    Utils<span style="color: #333333">.</span><span style="color: #0000CC">join</span><span style="color: #333333">(</span> thread <span style="color: #333333">);</span>
    assertEquals<span style="color: #333333">(</span> distinctProfile<span style="color: #333333">,</span> adHocProfile <span style="color: #333333">);</span>
    validateState<span style="color: #333333">(</span> distinctFile<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">,</span> ProfileFileManager<span style="color: #333333">.</span><span style="color: #0000CC">APPROVE</span> <span style="color: #333333">);</span>
<span style="color: #333333">}</span>
</pre></td></tr></tbody></table></div>

</td>
</tr>

<tr>
<td colspan="2">
<p>
As with the 
<a href="#testSaveProfile">
    <em>save( Profile profile, File file )</em>
    and <em>saveAs( Profile profile )</em>
</a>
test methods,
the only difference between these two methods
is how we handle file chooser interaction
at line 4,
where we anticipate (if necessary)
the expected value 
of the last-action property
at the end of the test,
and lines 8 and 9
where we configure the file chooser
and press its <em>Save</em> button.
Taking that into account,
we can implement a helper method
that encapsulates all the duplicate code:
</p>

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #888888">/*</span>
<span style="color: #888888">private void openGoRight(</span>
<span style="color: #888888">    Supplier&lt;Profile&gt; supplier, </span>
<span style="color: #888888">    File file, </span>
<span style="color: #888888">    boolean expectChooser</span>
<span style="color: #888888">)</span>
<span style="color: #888888">{</span>
<span style="color: #888888">    verify the target file exists</span>
<span style="color: #888888">    expAction = fileMgr.getLastAction()</span>
<span style="color: #888888">    formulate the Runnable that will drive a dedicated thread:</span>
<span style="color: #888888">        Runnable runner = () -&gt; adHocProfile = supplier.get();</span>
<span style="color: #888888">    create and start the thread</span>
<span style="color: #888888">    pause to allow file chooser to post (if necessary)</span>
<span style="color: #888888">    if ( expectChooser )</span>
<span style="color: #888888">    {</span>
<span style="color: #888888">        find the file chooser&#39;s text field</span>
<span style="color: #888888">        enter the file name into the text field</span>
<span style="color: #888888">        click on the open button</span>
<span style="color: #888888">        expAction = APPROVE</span>
<span style="color: #888888">    }</span>
<span style="color: #888888">    verify an error dialog was not posted</span>
<span style="color: #888888">    join the thread</span>
<span style="color: #888888">    verify the value of adHocResult</span>
<span style="color: #888888">    validateState( file, true, expAction );</span>
<span style="color: #888888">}</span>
<span style="color: #888888">*/</span>
</pre></td></tr></tbody></table></div>


<p>
Re-writing our test methods
to take advantage of the above,
we get:
</p>
</td>
</tr>

<tr> 
<td style="border: .2em solid black;">open()</td>
<td style="border: .2em solid black;">open( File file )</td>
</tr>

<tr>
<td style="border: .2em solid black; vertical-align: top; 0;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7
8</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #555555; font-weight: bold">@Test</span>
<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">testOpenGoRight</span><span style="color: #333333">()</span>
<span style="color: #333333">{</span>
    Supplier<span style="color: #333333">&lt;</span>Profile<span style="color: #333333">&gt;</span>   supplier    <span style="color: #333333">=</span> 
        <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">open</span><span style="color: #333333">();</span>
    openGoRight<span style="color: #333333">(</span> supplier<span style="color: #333333">,</span> distinctFile<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">true</span> <span style="color: #333333">);</span>
    assertEquals<span style="color: #333333">(</span> distinctProfile<span style="color: #333333">,</span> adHocProfile <span style="color: #333333">);</span>
<span style="color: #333333">}</span>
</pre></td></tr></tbody></table></div>


</td>
<td style="border: .2em solid black; vertical-align: top; 0;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7
8</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #555555; font-weight: bold">@Test</span>
<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">testOpenFileGoRight</span><span style="color: #333333">()</span>
<span style="color: #333333">{</span>
    Supplier<span style="color: #333333">&lt;</span>Profile<span style="color: #333333">&gt;</span>   supplier    <span style="color: #333333">=</span> 
        <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">open</span><span style="color: #333333">(</span> distinctFile <span style="color: #333333">);</span>
    openGoRight<span style="color: #333333">(</span> supplier<span style="color: #333333">,</span> distinctFile<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">false</span> <span style="color: #333333">);</span>
    assertEquals<span style="color: #333333">(</span> distinctProfile<span style="color: #333333">,</span> adHocProfile <span style="color: #333333">);</span>
<span style="color: #333333">}</span>
</pre></td></tr></tbody></table></div>

</td>
</tr>
<tr>
<td colspan="2">
<p>
Let's look at a couple of go-wrong tests,
executing a save or open operation
that results in an I/O error.
On the left side of the figure
is a go-wrong test
that requires operation interaction with the file chooser,
on the right is a test
that does not require operator intervention.
</p>
</td>
</tr>


<tr> 
<td style="border: .2em solid black;">saveAs( Profile profile )</td>
<td style="border: .2em solid black;">save( Profile profile, File file )</td>
</tr>
<tr> 
<td style="border: .2em solid black; vertical-align: top; 0;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #555555; font-weight: bold">@Test</span>
<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">testSaveAsProfileGoWrong</span><span style="color: #333333">()</span>
<span style="color: #333333">{</span>
    assertTrue<span style="color: #333333">(</span> noAccessFile<span style="color: #333333">.</span><span style="color: #0000CC">exists</span><span style="color: #333333">()</span> <span style="color: #333333">);</span>
    assertFalse<span style="color: #333333">(</span> noAccessFile<span style="color: #333333">.</span><span style="color: #0000CC">canWrite</span><span style="color: #333333">()</span> <span style="color: #333333">);</span>

    Thread  thread  <span style="color: #333333">=</span> executeChooserOp<span style="color: #333333">(</span> 
        <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> adHocResult <span style="color: #333333">=</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">saveAs</span><span style="color: #333333">(</span> adHocProfile <span style="color: #333333">)</span>
    <span style="color: #333333">);</span>
    enterPath<span style="color: #333333">(</span> noAccessName <span style="color: #333333">);</span>
    clickOn<span style="color: #333333">(</span> saveButton <span style="color: #333333">);</span>
    assertTrue<span style="color: #333333">(</span> dismissErrorDialog<span style="color: #333333">()</span> <span style="color: #333333">);</span>
    Utils<span style="color: #333333">.</span><span style="color: #0000CC">join</span><span style="color: #333333">(</span> thread <span style="color: #333333">);</span>
    validateState<span style="color: #333333">(</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">,</span> ProfileFileManager<span style="color: #333333">.</span><span style="color: #0000CC">APPROVE</span> <span style="color: #333333">);</span>
<span style="color: #333333">}</span>
</pre></td></tr></tbody></table></div>



</td>
<td style="border: .2em solid black; vertical-align: top; 0;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #555555; font-weight: bold">@Test</span>
<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">testSaveProfileFileGoWrong</span><span style="color: #333333">()</span>
<span style="color: #333333">{</span>
    assertTrue<span style="color: #333333">(</span> noAccessFile<span style="color: #333333">.</span><span style="color: #0000CC">exists</span><span style="color: #333333">()</span> <span style="color: #333333">);</span>
    assertFalse<span style="color: #333333">(</span> noAccessFile<span style="color: #333333">.</span><span style="color: #0000CC">canWrite</span><span style="color: #333333">()</span> <span style="color: #333333">);</span>
    <span style="color: #333399; font-weight: bold">int</span> expAction   <span style="color: #333333">=</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">getLastAction</span><span style="color: #333333">();</span>
    Thread  thread  <span style="color: #333333">=</span> executeNonChooserOp<span style="color: #333333">(</span> 
        <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">save</span><span style="color: #333333">(</span> <span style="color: #008800; font-weight: bold">new</span> Profile<span style="color: #333333">(),</span> noAccessFile <span style="color: #333333">)</span>
    <span style="color: #333333">);</span>
    
    
    assertTrue<span style="color: #333333">(</span> dismissErrorDialog<span style="color: #333333">()</span> <span style="color: #333333">);</span>
    Utils<span style="color: #333333">.</span><span style="color: #0000CC">join</span><span style="color: #333333">(</span> thread <span style="color: #333333">);</span>
    validateState<span style="color: #333333">(</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">,</span> expAction <span style="color: #333333">);</span>
<span style="color: #333333">}</span>
</pre></td></tr></tbody></table></div>

</td>
</tr>

<tr> 
<td style="border: .2em solid black;">open()</td>
<td style="border: .2em solid black;">open( File file )</td>
</tr>

<tr> 
<td style="border: .2em solid black; vertical-align: top; 0;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #555555; font-weight: bold">@Test</span>
<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">testOpenGoWrong</span><span style="color: #333333">()</span>
<span style="color: #333333">{</span>

    Thread  thread  <span style="color: #333333">=</span> executeChooserOp<span style="color: #333333">(</span> 
        <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> adHocProfile <span style="color: #333333">=</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">open</span><span style="color: #333333">()</span>
    <span style="color: #333333">);</span>
    enterPath<span style="color: #333333">(</span> noSuchFileName <span style="color: #333333">);</span>
    clickOn<span style="color: #333333">(</span> openButton <span style="color: #333333">);</span>
    assertTrue<span style="color: #333333">(</span> dismissErrorDialog<span style="color: #333333">()</span> <span style="color: #333333">);</span>
    Utils<span style="color: #333333">.</span><span style="color: #0000CC">join</span><span style="color: #333333">(</span> thread <span style="color: #333333">);</span>
    assertNull<span style="color: #333333">(</span> adHocProfile <span style="color: #333333">);</span>
    validateState<span style="color: #333333">(</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">,</span> ProfileFileManager<span style="color: #333333">.</span><span style="color: #0000CC">APPROVE</span> <span style="color: #333333">);</span>
<span style="color: #333333">}</span>
</pre></td></tr></tbody></table></div>

</td>
<td style="border: .2em solid black; vertical-align: top; 0;">

<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #555555; font-weight: bold">@Test</span>
<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">testOpenFileGoWrong</span><span style="color: #333333">()</span>
<span style="color: #333333">{</span>
    <span style="color: #333399; font-weight: bold">int</span>     expAction   <span style="color: #333333">=</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">getLastAction</span><span style="color: #333333">();</span>
    Thread  thread      <span style="color: #333333">=</span> executeChooserOp<span style="color: #333333">(</span> 
        <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> adHocProfile <span style="color: #333333">=</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">open</span><span style="color: #333333">(</span> noSuchFile <span style="color: #333333">)</span>
    <span style="color: #333333">);</span>


    assertTrue<span style="color: #333333">(</span> dismissErrorDialog<span style="color: #333333">()</span> <span style="color: #333333">);</span>
    Utils<span style="color: #333333">.</span><span style="color: #0000CC">join</span><span style="color: #333333">(</span> thread <span style="color: #333333">);</span>
    assertNull<span style="color: #333333">(</span> adHocProfile <span style="color: #333333">);</span>
    validateState<span style="color: #333333">(</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">,</span> expAction <span style="color: #333333">);</span>
<span style="color: #333333">}</span>
</pre></td></tr></table></div>

</td>
</tr>

<tr>
<td colspan="2">
<p>
As we did with the go-right helper methods,
we can encapsulate common code
in save-go-wrong and open-go-wrong methods,
as seen here:
</p>
</td>
</tr>

<tr> 
<td style="border: .2em solid black; vertical-align: top; 0;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #888888">/*</span>
<span style="color: #888888">private void saveGoWrong( </span>
<span style="color: #888888">    BooleanSupplier supplier, </span>
<span style="color: #888888">    File file, </span>
<span style="color: #888888">    boolean expectChooser</span>
<span style="color: #888888">)</span>
<span style="color: #888888">{</span>
<span style="color: #888888">    expAction = fileMgr.getLastAction()</span>
<span style="color: #888888">    formulate the Runnable that will drive a dedicated thread:</span>
<span style="color: #888888">        Runnable runner = </span>
<span style="color: #888888">            () -&gt; adHocResult = supplier.getAsBoolean();</span>
<span style="color: #888888">    pause to allow file chooser to post (if necessary)</span>
<span style="color: #888888">    if ( expectChooser )</span>
<span style="color: #888888">    {</span>
<span style="color: #888888">        find the file chooser&#39;s text field</span>
<span style="color: #888888">        enter the file name into the text field</span>
<span style="color: #888888">        click on the save button</span>
<span style="color: #888888">        expAction = APPROVE</span>
<span style="color: #888888">    }</span>
<span style="color: #888888">    verify an error dialog was posted</span>
<span style="color: #888888">    join the thread</span>
<span style="color: #888888">    verify the value of adHocResult</span>
<span style="color: #888888">    validateState( file, true, expAction );</span>
<span style="color: #888888">}</span>
<span style="color: #888888">*/</span>
</pre></td></tr></tbody></table></div>



</td>
<td style="border: .2em solid black; vertical-align: top; 0;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #888888">/*</span>
<span style="color: #888888">private void openGoWrong(</span>
<span style="color: #888888">    Supplier&lt;Profile&gt; supplier, </span>
<span style="color: #888888">    File file, </span>
<span style="color: #888888">    boolean expectChooser</span>
<span style="color: #888888">)</span>
<span style="color: #888888">{</span>
<span style="color: #888888">    expAction = fileMgr.getLastAction()</span>
<span style="color: #888888">    formulate the Runnable that will drive a dedicated thread:</span>
<span style="color: #888888">        Runnable runner = </span>
<span style="color: #888888">            () -&gt; adHocProfile = supplier.get()</span>
<span style="color: #888888">    pause to allow file chooser to post (if necessary)</span>
<span style="color: #888888">    if ( expectChooser )</span>
<span style="color: #888888">    {</span>
<span style="color: #888888">        find the file chooser&#39;s text field</span>
<span style="color: #888888">        enter the file name into the text field</span>
<span style="color: #888888">        click on the open button</span>
<span style="color: #888888">        expAction = APPROVE</span>
<span style="color: #888888">    }</span>
<span style="color: #888888">    verify an error dialog was posted</span>
<span style="color: #888888">    join the thread</span>
<span style="color: #888888">    verify the value of adHocProfile</span>
<span style="color: #888888">    validateState( file, true, expAction );</span>
<span style="color: #888888">}</span>
<span style="color: #888888">*/</span>
</pre></td></tr></tbody></table></div>

</td>
</tr>
<tr>
<td colspan="2">
<p>
And then we can rewrite our go-wrong test methods
as shown below.
</p>
</td>
</tr>
<tr> 
<td style="border: .2em solid black;">open()</td>
<td style="border: .2em solid black;">open( File file )</td>
</tr>

<tr> 
<td style="border: .2em solid black; vertical-align: top; 0;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #555555; font-weight: bold">@Test</span>
<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">testOpenGoWrong</span><span style="color: #333333">()</span>
<span style="color: #333333">{</span>
    Supplier<span style="color: #333333">&lt;</span>Profile<span style="color: #333333">&gt;</span>   supplier    <span style="color: #333333">=</span> 
        <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">open</span><span style="color: #333333">();</span>
    openGoWrong<span style="color: #333333">(</span> supplier<span style="color: #333333">,</span> noSuchFile<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">true</span> <span style="color: #333333">);</span>
<span style="color: #333333">}</span>
</pre></td></tr></tbody></table></div>



</td>
<td style="border: .2em solid black; vertical-align: top; 0;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #555555; font-weight: bold">@Test</span>
<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">testOpenFileGoWrong</span><span style="color: #333333">()</span>
<span style="color: #333333">{</span>
    Supplier<span style="color: #333333">&lt;</span>Profile<span style="color: #333333">&gt;</span>   supplier    <span style="color: #333333">=</span> 
        <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">open</span><span style="color: #333333">(</span> noSuchFile <span style="color: #333333">);</span>
    openGoWrong<span style="color: #333333">(</span> supplier<span style="color: #333333">,</span> distinctFile<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">false</span> <span style="color: #333333">);</span>
<span style="color: #333333">}</span>
</pre></td></tr></tbody></table></div>

</td>
</tr>

<tr>
<td colspan="2">
<p>
One more type of test
can be encapsulated:
file manager operations that are canceled
via the file chooser dialog.
The encapsulation is easy
because we don't need different methods
for input and output operations.
Below are two figures;
the first shows the pseudocode
for a method
that encapsulates the cancel logic,
and the second presents
one input cancel test
and one output cancel test.
</p>
</td>
</tr>

<tr>
<td colspan="2">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #888888">/*</span>
<span style="color: #888888">private void cancelOperation(</span>
<span style="color: #888888">    Supplier&lt;?&gt; supplier, </span>
<span style="color: #888888">    File file</span>
<span style="color: #888888">)</span>
<span style="color: #888888">{</span>
<span style="color: #888888">    expFile = fileMgr.getCurrFile();</span>
<span style="color: #888888">    expLastResult = fileMgr.getLastResult()</span>
<span style="color: #888888">    formulate the Runnable that will drive a dedicated thread:</span>
<span style="color: #888888">        Runnable    runner      = () -&gt; supplier.get() </span>
<span style="color: #888888">    start dedicate thread to encapsulate the operation</span>
<span style="color: #888888">    </span>
<span style="color: #888888">    pause to allow file chooser to post</span>
<span style="color: #888888">    find the file chooser&#39;s text field</span>
<span style="color: #888888">    enter the file name into the text field</span>
<span style="color: #888888">    click on the cancel button</span>

<span style="color: #888888">    join the thread</span>
<span style="color: #888888">    validateState( expFile, expResult, CANCEL )</span>
<span style="color: #888888">}</span>
<span style="color: #888888">*/</span>
</pre></td></tr></tbody></table></div>

</td>
</tr>
<tr>
<td colspan="2">
<ul>
<li>
    Line 3: 
    This time we declare out supplier
    with a wildcard (?) because
    we're using it 
    for both input (<em>Supplier&lt;Profile&gt;</em> required)
    and output (<em>Supplier&lt;Boolean&gt;</em> required) operations.
</li>
<li>
    Lines 7,8:
    Record the values of the current-file
    and last-result properties
    for validation at the end
    of the operation
    (canceled operation do not change these properties).
</li>
<li>
    Lines 9-11:
    Start the operation
    in a dedicated thread.
</li>
<li>
    Lines 13-16:
    There is not "expect file chooser" logic this time;
    cancel operation always go through the file chooser.
    Wait for the file chooser to post,
    enter the file name
    and push the <em>Cancel</em> button.
</li>
<li> Line 18: Wait for the dedicated thread to complete.</li>
<li>
    Line 19:
    Verify that the curr-file and last-result properties
    are unchanged,
    and the last-action property
    is set to <em>CANCEL</em>.
</li>
</ul>
<p>
Following are the revised test methods.
</p>
</td>
</tr>

<tr> 
<td style="border: .2em solid black;">open()</td>
<td style="border: .2em solid black;">saveAs()</td>
</tr>

<tr> 
<td style="border: .2em solid black; vertical-align: top; 0;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #555555; font-weight: bold">@Test</span>
<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">testOpenCancel</span><span style="color: #333333">()</span>
<span style="color: #333333">{</span>
    Supplier<span style="color: #333333">&lt;?&gt;</span> supplier    <span style="color: #333333">=</span> <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">open</span><span style="color: #333333">();</span>
    cancelOperation<span style="color: #333333">(</span> supplier<span style="color: #333333">,</span> baseFile <span style="color: #333333">);</span>
<span style="color: #333333">}</span>
</pre></td></tr></tbody></table></div>

</td>
<td style="border: .2em solid black; vertical-align: top; 0;">

<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #555555; font-weight: bold">@Test</span>
<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">testSaveAsCancel</span><span style="color: #333333">()</span>
<span style="color: #333333">{</span>
    Supplier<span style="color: #333333">&lt;?&gt;</span> supplier    <span style="color: #333333">=</span> <span style="color: #333333">()</span> <span style="color: #333333">-&gt;</span> fileMgr<span style="color: #333333">.</span><span style="color: #0000CC">saveAs</span><span style="color: #333333">();</span>
    cancelOperation<span style="color: #333333">(</span> supplier<span style="color: #333333">,</span> adHocFile<span style="color: #333333">);</span>
<span style="color: #333333">}</span>
</pre></td></tr></tbody></table></div>

</td>
</tr>

<tr>
<td colspan="2">
<p style="font-size: 110%; font-weight: bold; margin-bottom: 0;">
Final Thoughts
</p>
<tr>
<td colspan="2">
<p>
We can take this strategy
of encapsulating duplicate logic further,
if we wanted to.
We can imagine a method,
for example,
capable of handling any open operation:
</p>
<pre class="code">private void executeOpen(
    Supplier&lt;Profile&gt; supplier, 
    File file, 
    boolean expectChooser,
    boolean cancel,
    boolean expectError
)</pre>
<p>
While I am not,
in principle,
opposed to a method like this,
I think it would get awfully busy.
A better approach
might be to declare a nested class
with a state and factory methods
such as this:
</p>
<pre class="code">private class Operation
{
    private final Supplier&lt;Profile&gt; reader;
    private final BooleanSupplier   writer;
    private final boolean           requiresChooer;
    private final boolean           expectError;
    private final boolean           mustCancel;
    
    public Operation getInputGoRightTest( 
        Supplier&lt;Profile&gt; supplier,
        boolean requiresChooser
    ) 
    { ... }
    
    public Operation getOutputGoWrongTest( 
        BooleanSupplier supplier,
        boolean requiresChooser
    ) 
    { ... }
    
    public Operation getInputCancelTest( 
        Supplier&lt;Profile&gt; supplier
    ) 
    { ... }
    
    public void execute() { ... }
}</pre>
<p>
We could then divide the execution logic
between helper methods
in the nested class.
</p>

</tbody>
</table>


</body>
</html>
    